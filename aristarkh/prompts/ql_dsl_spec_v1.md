# DSL QL — спецификация v1 (расширено)

## 1) Зачем
QL нужен, чтобы превращать “человеческое намерение” в строгий запрос/промпт, который:
- повторяем,
- проверяем,
- ограничиваем по тону/объёму,
- фиксируем как артефакт (файл в репозитории).

QL — не магия.
QL — дисциплина формы и ответственность.

---

## 2) Минимальные секции
- role: кто отвечает (Aristarkh / Agent.Editor / Agent.Critic / Agent.Archivist / Agent.Builder)
- context: что важно помнить (коротко)
- goal: одна цель
- inputs: файлы/фрагменты/данные, которые даны
- constraints: запреты, формат, лимиты
- output_format: “дай файл целиком”, “дай bash команды”, “дай чек-лист”
- done_criteria: как понять, что готово
- risk_notes: риски (ToS/этика/сложность/ошибки)

---

## 3) Пример (YAML-подобный)
role: Aristarkh
context: |
  Проект relearning. Я учусь читать код. Нужны готовые листинги.
goal: |
  Добавить кнопку "Собрать сайт" в Flutter Writer и выводить лог.
inputs:
  - path: lang/flutter/quiet_logos_writer/lib/main.dart
constraints:
  - один экран
  - без новых пакетов
  - без магии: показывай весь файл целиком
output_format: |
  Дай готовый main.dart целиком и команды проверки.
done_criteria: |
  Приложение запускается, кнопка работает, лог виден.
risk_notes:
  - не ломать существующие пути
  - не делать асинхронщину без обработки ошибок

---

## 4) Компилятор (план)
Файл: `tools/ql/ql_compile.py`

Задачи:
- прочитать QL (пока как простой текст с секциями),
- нормализовать поля,
- сгенерировать промпт по `core/prompts/core_prompt.md`,
- добавить чек-лист проверки,
- записать результат в `core/prompts/generated/`.

Важно:
- в v1 допускается “минимальная реализация” без парсера YAML.
- сначала дисциплина, потом удобство.

---

## 5) Валидация
Обязательные поля:
- role, goal, constraints, output_format, done_criteria

Лимиты по умолчанию:
- context ≤ 1500 символов
- goal ≤ 500 символов
- done_criteria ≤ 500 символов

Режимы:
- strict: для кода (требовать листинги целиком)
- soft: для обсуждения и планирования

---

## 6) Философия QL
QL — это договор:
- что я хочу,
- чего я не хочу,
- как проверить,
- кто ответственен.

Человек остаётся ответственным.
ИИ помогает удерживать форму.
